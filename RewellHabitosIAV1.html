<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Panel de Bienestar con IA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Rewell Navy & Orange -->
    <!-- Application Structure Plan: A single-page dashboard design with a sticky top navigation bar for easy access to key sections. The main content area uses a card-based design with generous spacing, a clean color palette (slate, white, orange accents), and custom SVG icons to create a professional, visually appealing, and highly scannable user experience. This structure was chosen to align with user preference for a traditional top navigation layout while maintaining a modern app-like feel for the content. -->
    <!-- Visualization & Content Choices: All Chart.js visualizations have been removed. Information is now presented textually within structured cards. Custom inline SVG icons are used extensively to provide visual cues and break up text, enhancing the UI without relying on raster images or external libraries. The educational aspect is retained and enhanced through clearly titled sections and the detailed "Beneficio Clave" column in the nutrition plan. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9; /* slate-100 */
        }
        .file-drop-zone {
            transition: all 0.3s ease;
        }
        .file-drop-zone.dragover {
            border-color: #f97316; /* orange-500 */
            background-color: #fff7ed; /* orange-50 */
        }
        .nav-link {
            transition: all 0.3s ease;
            border-bottom: 2px solid transparent;
        }
        .nav-link.active {
            color: #f97316; /* orange-500 */
            border-bottom-color: #f97316;
        }
        #results-screen {
            display: none;
        }
        #loading-screen {
            display: none;
        }
        /* Loading animation styles */
        .dot-pulse {
            animation: dotPulse 1.5s infinite ease-in-out;
        }
        .dot-pulse:nth-child(2) {
            animation-delay: 0.2s;
        }
        .dot-pulse:nth-child(3) {
            animation-delay: 0.4s;
        }
        @keyframes dotPulse {
            0%, 100% {
                transform: scale(0.8);
                opacity: 0.8;
            }
            50% {
                transform: scale(1.2);
                opacity: 1;
            }
        }
        /* Print styles */
        @media print {
            body {
                background-color: #ffffff !important;
            }
            header, footer.web-footer, .no-print {
                display: none !important;
            }
            main {
                padding: 0 !important;
                margin: 0 !important;
            }
            .print-break-avoid {
                page-break-inside: avoid;
            }
            section {
                page-break-before: always;
                margin-top: 0 !important;
                padding-top: 2rem !important;
            }
            section:first-child {
                page-break-before: auto;
            }
            .bg-white {
                 box-shadow: none !important;
                 border: 1px solid #e2e8f0;
            }
        }
    </style>
</head>
<body class="text-slate-700">

    <div id="upload-screen" class="min-h-screen flex items-center justify-center p-4" style="background-color: #0c1e3e;">
        <div class="w-full max-w-2xl mx-auto bg-white p-8 rounded-2xl shadow-xl text-center">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-800 mb-4 mt-4">Generador de Panel de Bienestar</h1>
            <p class="text-slate-600 mb-8">Selecciona una opción para subir tu reporte de REWELL.</p>

            <div class="flex justify-center border border-slate-200 rounded-lg p-1 mb-8 bg-slate-100">
                <button id="single-file-toggle" class="flex-1 py-2 px-4 rounded-md text-sm font-semibold transition-colors">Un solo reporte</button>
                <button id="dual-file-toggle" class="flex-1 py-2 px-4 rounded-md text-sm font-semibold transition-colors">Dos reportes separados</button>
            </div>

            <div id="single-file-view">
                <div id="drop-zone-single" class="file-drop-zone border-2 border-dashed border-slate-300 rounded-lg p-10 text-center cursor-pointer hover:border-orange-500">
                    <input type="file" id="report-file-single" class="hidden" accept=".pdf">
                    <svg class="mx-auto h-16 w-16 text-slate-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5" /></svg>
                    <p class="mt-4 text-slate-600"><span class="font-semibold text-orange-600">Sube tu reporte completo de REWELL</span></p>
                    <p class="text-xs text-slate-500 mt-1">Arrastra tu archivo aquí o haz clic para seleccionarlo</p>
                </div>
            </div>

            <div id="dual-file-view" class="hidden">
                 <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div id="drop-zone-genetics" class="file-drop-zone border-2 border-dashed border-slate-300 rounded-lg p-6 text-center cursor-pointer hover:border-orange-500">
                        <input type="file" id="genetics-file" class="hidden" accept=".pdf">
                        <svg class="mx-auto h-12 w-12 text-slate-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5" /></svg>
                        <p class="mt-2 text-sm text-slate-600"><span class="font-semibold text-orange-600">Sube el reporte de Genética</span></p>
                    </div>
                    <div id="drop-zone-microbiome" class="file-drop-zone border-2 border-dashed border-slate-300 rounded-lg p-6 text-center cursor-pointer hover:border-orange-500">
                        <input type="file" id="microbiome-file" class="hidden" accept=".pdf">
                         <svg class="mx-auto h-12 w-12 text-slate-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5" /></svg>
                        <p class="mt-2 text-sm text-slate-600"><span class="font-semibold text-orange-600">Sube el reporte de Microbioma</span></p>
                    </div>
                </div>
            </div>
            
            <div id="file-list" class="mt-4 text-left"></div>

            <button id="analyze-button" class="mt-8 w-full bg-orange-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-orange-600 transition-colors disabled:bg-slate-300 disabled:cursor-not-allowed">
                Generar mi Panel
            </button>
             <p id="error-message" class="text-red-500 text-sm mt-4 hidden"></p>
        </div>
    </div>

    <div id="loading-screen" class="min-h-screen flex items-center justify-center p-4 text-center">
        <div>
            <div class="flex justify-center items-center space-x-2 mb-6">
                <div class="dot-pulse h-8 w-8 bg-orange-500 rounded-full"></div>
                <div class="dot-pulse h-8 w-8 bg-orange-500 rounded-full"></div>
                <div class="dot-pulse h-8 w-8 bg-orange-500 rounded-full"></div>
            </div>
            <h2 id="loading-title" class="text-2xl font-semibold text-slate-700 mb-2">Analizando tus reportes...</h2>
            <p id="loading-text" class="text-slate-500">El análisis puede demorar entre 3 y 5 minutos. ¡Puedes ir a buscar un café si quieres!</p>
        </div>
    </div>

    <div id="results-screen">
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const uploadScreen = document.getElementById('upload-screen');
            const loadingScreen = document.getElementById('loading-screen');
            const resultsScreen = document.getElementById('results-screen');
            const analyzeButton = document.getElementById('analyze-button');
            const errorMessage = document.getElementById('error-message');
            const loadingTitle = document.getElementById('loading-title');
            const loadingText = document.getElementById('loading-text');

            const singleFileToggle = document.getElementById('single-file-toggle');
            const dualFileToggle = document.getElementById('dual-file-toggle');
            const singleFileView = document.getElementById('single-file-view');
            const dualFileView = document.getElementById('dual-file-view');
            
            const dropZoneSingle = document.getElementById('drop-zone-single');
            const fileInputSingle = document.getElementById('report-file-single');
            const dropZoneGenetics = document.getElementById('drop-zone-genetics');
            const fileInputGenetics = document.getElementById('genetics-file');
            const dropZoneMicrobiome = document.getElementById('drop-zone-microbiome');
            const fileInputMicrobiome = document.getElementById('microbiome-file');
            
            const fileList = document.getElementById('file-list');

            let uploadMode = 'single';
            let reportFile = null;
            let geneticsFile = null;
            let microbiomeFile = null;
            const MAX_FILE_SIZE_SINGLE = 25 * 1024 * 1024; // 25 MB
            const MAX_FILE_SIZE_DUAL = 10 * 1024 * 1024; // 10 MB

            function showError(message) {
                errorMessage.textContent = message;
                errorMessage.classList.toggle('hidden', !message);
            }
            
            function updateButtonState() {
                if (uploadMode === 'single') {
                    analyzeButton.disabled = !reportFile;
                } else {
                    analyzeButton.disabled = !(geneticsFile && microbiomeFile);
                }
            }

            function updateFileListUI() {
                fileList.innerHTML = '';
                if (uploadMode === 'single') {
                    if (reportFile) fileList.innerHTML = `<p class="text-sm text-slate-600"><span class="font-semibold text-emerald-600">✓ Reporte Cargado:</span> ${reportFile.name}</p>`;
                } else {
                    fileList.innerHTML = `
                        <p class="text-sm ${geneticsFile ? 'text-slate-600' : 'text-slate-500'}"><span class="font-semibold ${geneticsFile ? 'text-emerald-600' : ''}">${geneticsFile ? '✓' : ''} Reporte de Genética:</span> ${geneticsFile ? geneticsFile.name : 'No cargado'}</p>
                        <p class="text-sm ${microbiomeFile ? 'text-slate-600' : 'text-slate-500'}"><span class="font-semibold ${microbiomeFile ? 'text-emerald-600' : ''}">${microbiomeFile ? '✓' : ''} Reporte de Microbioma:</span> ${microbiomeFile ? microbiomeFile.name : 'No cargado'}</p>
                    `;
                }
            }

            function setUploadMode(mode) {
                uploadMode = mode;
                if (mode === 'single') {
                    singleFileToggle.classList.add('bg-white', 'text-orange-700');
                    dualFileToggle.classList.remove('bg-white', 'text-orange-700');
                    singleFileView.classList.remove('hidden');
                    dualFileView.classList.add('hidden');
                } else {
                    dualFileToggle.classList.add('bg-white', 'text-orange-700');
                    singleFileToggle.classList.remove('bg-white', 'text-orange-700');
                    dualFileView.classList.remove('hidden');
                    singleFileView.classList.add('hidden');
                }
                reportFile = null;
                geneticsFile = null;
                microbiomeFile = null;
                updateFileListUI();
                updateButtonState();
            }

            function handleFile(file, fileVarSetter, mode) {
                const maxSize = mode === 'single' ? MAX_FILE_SIZE_SINGLE : MAX_FILE_SIZE_DUAL;
                const maxSizeText = mode === 'single' ? '25 MB' : '10 MB';
                
                if (file.size > maxSize) {
                    showError(`El archivo "${file.name}" es demasiado grande (máx. ${maxSizeText}).`);
                    fileVarSetter(null);
                } else {
                    fileVarSetter(file);
                    showError("");
                }
                updateFileListUI();
                updateButtonState();
            }

            function setupDropZone(dropZone, fileInput, fileVarSetter, mode) {
                dropZone.addEventListener('click', () => fileInput.click());
                ['dragover', 'dragenter'].forEach(eventName => dropZone.addEventListener(eventName, e => { e.preventDefault(); dropZone.classList.add('dragover'); }));
                ['dragleave', 'drop'].forEach(eventName => dropZone.addEventListener(eventName, e => { e.preventDefault(); dropZone.classList.remove('dragover'); }));
                dropZone.addEventListener('drop', e => handleFile(e.dataTransfer.files[0], fileVarSetter, mode));
                fileInput.addEventListener('change', e => handleFile(e.target.files[0], fileVarSetter, mode));
            }

            setupDropZone(dropZoneSingle, fileInputSingle, (file) => reportFile = file, 'single');
            setupDropZone(dropZoneGenetics, fileInputGenetics, (file) => geneticsFile = file, 'dual');
            setupDropZone(dropZoneMicrobiome, fileInputMicrobiome, (file) => microbiomeFile = file, 'dual');

            singleFileToggle.addEventListener('click', () => setUploadMode('single'));
            dualFileToggle.addEventListener('click', () => setUploadMode('dual'));
            setUploadMode('single');

            const pdfToBase64 = (file) => new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result.toString().replace(/^data:.+;base64,/, ''));
                reader.onerror = error => reject(error);
            });
            
            const resetApp = () => {
                resultsScreen.style.display = 'none';
                loadingScreen.style.display = 'none';
                uploadScreen.style.display = 'flex';
                reportFile = geneticsFile = microbiomeFile = null;
                fileInputSingle.value = fileInputGenetics.value = fileInputMicrobiome.value = "";
                updateFileListUI();
                showError("");
                updateButtonState();
            };

            const handleAnalysis = async () => {
                if ((uploadMode === 'single' && !reportFile) || (uploadMode === 'dual' && (!geneticsFile || !microbiomeFile))) {
                    showError("Por favor, sube los archivos requeridos.");
                    return;
                }
                
                showError("");
                loadingTitle.textContent = "Analizando tu reporte...";
                loadingText.textContent = "El análisis puede demorar entre 3 y 5 minutos. ¡Puedes ir a buscar un café si quieres!";
                uploadScreen.style.display = 'none';
                loadingScreen.style.display = 'flex';

                try {
                    const apiKey = "AIzaSyASKTV6JD2FfHqH7HTKbeXVnmn2pQJ_OvQ"; 
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`;
                    
                    let prompt;
                    let parts = [];

                    if (uploadMode === 'single') {
                        prompt = `Actúa como un coach de salud y diseñador de UI/UX experto en nutrigenética y microbioma intestinal. Tu tarea es analizar un reporte de REWELL en PDF que contiene AMBAS secciones (genética y microbioma) y generar un panel de bienestar visualmente atractivo, integrado y accionable.`;
                        parts.push({ text: prompt });
                        parts.push({ inlineData: { mimeType: "application/pdf", data: await pdfToBase64(reportFile) } });
                    } else {
                        prompt = `Actúa como un coach de salud y diseñador de UI/UX experto en nutrigenética y microbioma intestinal. Tu tarea es analizar dos reportes de REWELL en PDF (uno de genética y otro de microbioma) y generar un panel de bienestar visualmente atractivo, integrado y accionable.`;
                        parts.push({ text: prompt });
                        parts.push({ inlineData: { mimeType: "application/pdf", data: await pdfToBase64(geneticsFile) } });
                        parts.push({ inlineData: { mimeType: "application/pdf", data: await pdfToBase64(microbiomeFile) } });
                    }

                    const commonInstructions = `
                        **Misión Crítica:** Genera el CÓDIGO HTML COMPLETO para el panel de resultados. El HTML debe incluir un <header>, un <main> y un <footer>. El diseño debe tener una barra de navegación superior fija y un contenido principal bien estructurado con tarjetas e iconos. El nombre del usuario se encuentra en los reportes.

                        **Análisis y Contenido Requerido - PRESTA MUCHA ATENCIÓN:**

                        1.  **Análisis Integrado y Profundo:** Es **CRUCIAL** que analices el/los reporte(s) completo(s), dando la misma importancia a la sección de genética y a la de microbioma. Las recomendaciones deben ser una **SÍNTESIS** de ambos. Para **CADA** desbalance o deficiencia que encuentres, debes explicarlo y luego OBLIGATORIAMENTE proponer una sección de "**Acciones Concretas y Prácticas**" para corregirlo.
                        2.  **Extracción de Datos Clave del Microbioma:** Del reporte, extrae y destaca específicamente los hallazgos negativos como: baja producción de SCFA/Butirato, desbalance en el ratio Firmicutes/Bacteroidetes, niveles elevados de Proteobacterias, y cualquier predisposición a constipación o inflamación. Estos deben ser puntos centrales en las recomendaciones.
                        
                        **Estructura del Reporte de Salida (HTML):**

                        1.  **Header Fijo:** Un \`<header class="bg-white shadow-md sticky top-0 z-50 no-print">\` que contenga un \`<h1>\` "Tu Panel de Bienestar, [Nombre del Usuario]", una barra de navegación con enlaces a las 5 secciones, y dos botones: "Exportar a PDF" \`<button id="print-button" ...>\` y "Reiniciar" \`<button id="reset-button" ...>\`.
                        2.  **Contenido Principal (<main>):**
                            * **Sección 1 (id="seccion1"): Puntos de Atención Clave:** Título claro con un icono SVG. Un grid de 3 columnas con tarjetas para "Tus Fortalezas", "Tus Áreas de Atención" y "Tus Puntos de Acción Prioritarios". Cada tarjeta con icono. **Asegúrate de que los hallazgos del microbioma estén bien representados aquí.**
                            * **Sección 2 (id="seccion2"): Tu Estado Vitamínico (Genética + Microbioma):** Título claro con un icono SVG. Esta sección es CRÍTICA. Debe tener un grid de tarjetas (2 o 3 columnas). Cada tarjeta representa una vitamina en estado de atención o prioritario. La tarjeta debe detallar claramente: "**Hallazgo Genético:**", "**Hallazgo del Microbioma:**" (si aplica, si no, debes poner "No presenta deficiencias"), y "**Acciones Concretas:**" con recomendaciones prácticas. **REGLA CRÍTICA: DEBES buscar explícitamente la sección 'Producción de vitamina K2 por el microbioma' para la Vitamina K y mostrarla.**
                            * **Sección 3 (id="seccion3"): Tu Estrategia de Nutrición y Plan Semanal:** Título claro con un icono SVG. Una tarjeta para "Puntos Clave de Nutrición". Debajo, otra tarjeta para la tabla del "plan nutricional semanal educativo basado en tus perfiles genetico y de microbiota". **La tabla debe estar completa de Lunes a Domingo.** **La columna "Beneficio Clave" debe ser muy específica y educativa,** ej: "Aporta fibra para tus bacterias productoras de Butirato, que se encuentran bajas".
                            * **Sección 4 (id="seccion4"): Bienestar, Deporte y Descanso:** Título claro con un icono SVG. Un grid de 2 columnas con tarjetas para "Tu Perfil Deportivo" y "Optimiza tu Descanso", cada una con sus "Acciones Concretas".
                            * **Sección 5 (id="seccion5"): Salud Preventiva y Microbioma:** Título claro con un icono SVG. Grid de 2 columnas. Una tarjeta para "Salud Preventiva" (listando los puntos como Tiroiditis, etc.). **REGLA CRÍTICA:** Para cada condición en esta tarjeta, **SOLO** debes incluir una subsección de "**Acciones Concretas**" si el reporte indica un riesgo 'alto', 'elevado' o 'aumentado'. Si el riesgo es 'promedio', 'normal' o 'bajo', **NO** debes incluir acciones concretas para ese punto. La otra tarjeta será para "Claves de tu Microbioma", **detallando los hallazgos importantes del reporte de microbioma y sus acciones concretas.**
                        3. **Footer:** Un \`<footer class="web-footer text-center p-6 mt-12 bg-slate-100 text-xs text-slate-500 no-print">\` con el texto: "Rewell es propiedad de Heritas (www.heritas.com.ar). Los test de ADN de Rewell no indican un diagnóstico médico sobre ninguna de las condiciones de salud incluidas. Estos test entregan información que podrían ayudar en la prevención temprana para tomar decisiones informadas. Si usted presenta alguna patología o sintomatología preexistente debería consultarlo con su médico habitual."

                        **Instrucciones Adicionales:**
                        * El output debe ser únicamente el código HTML desde la etiqueta \`<header>\` hasta el final de la etiqueta \`</footer>\`.
                        * No incluyas \`<html>\`, \`<head>\`, \`<body>\`, ni el script de inicialización.
                        * El idioma de todo el contenido debe ser Español.
                        * Usa un diseño limpio, con fondos \`bg-white\` para las tarjetas, sombras \`shadow-md\`, y esquinas redondeadas \`rounded-lg\`. Usa naranja claro como color de acento.
                        * Usa iconos SVG inline de Heroicons o similares para un look profesional.
                        * **CRÍTICO: No utilices gráficos de Chart.js ni la etiqueta <canvas>.**
                    `;
                    parts.push({ text: commonInstructions });

                    const payload = { contents: [{ role: "user", parts: parts }] };

                    let response;
                    const maxRetries = 3;
                    let attempt = 0;
                    let delay = 2000;

                    while (attempt < maxRetries) {
                        attempt++;
                        response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });

                        if (response.ok) break;

                        if (response.status === 429 || response.status === 503) {
                            if (attempt >= maxRetries) throw new Error("El modelo de IA está sobrecargado. Por favor, inténtalo de nuevo más tarde.");
                            loadingText.textContent = `El modelo está ocupado. Reintentando en ${delay / 1000} segundos... (Intento ${attempt}/${maxRetries})`;
                            await new Promise(resolve => setTimeout(resolve, delay));
                            delay *= 2;
                        } else {
                            let errorDetail = `Error: ${response.status} ${response.statusText}`;
                            try {
                                const errorResult = await response.json();
                                if (errorResult.error && errorResult.error.message) errorDetail = errorResult.error.message;
                            } catch (e) {
                               errorDetail = "No se pudo obtener detalle del error de la API.";
                            }
                            throw new Error(errorDetail);
                        }
                    }
                    
                    const result = await response.json();
                    
                    if (result.candidates && result.candidates.length > 0 && result.candidates[0].content && result.candidates[0].content.parts.length > 0) {
                        let htmlContent = result.candidates[0].content.parts[0].text;
                        htmlContent = htmlContent.replace(/```html/g, '').replace(/```/g, '');
                        resultsScreen.innerHTML = htmlContent;
                        loadingScreen.style.display = 'none';
                        resultsScreen.style.display = 'block';
                        initializeResultsScreen();
                    } else {
                         if (result.promptFeedback && result.promptFeedback.blockReason) {
                            throw new Error(`La solicitud fue bloqueada por la API. Razón: ${result.promptFeedback.blockReason}`);
                        }
                        throw new Error("Respuesta inesperada o vacía de la API. El modelo no pudo procesar los reportes.");
                    }

                } catch (error) {
                    console.error("Detailed error:", error);
                    showError(`Ocurrió un error al analizar los reportes: ${error.message}`);
                    loadingScreen.style.display = 'none';
                    uploadScreen.style.display = 'flex';
                }
            };
            
            const initializeResultsScreen = () => {
                const resetButton = document.getElementById('reset-button');
                if (resetButton) {
                    resetButton.addEventListener('click', resetApp);
                }
                const printButton = document.getElementById('print-button');
                if(printButton) {
                    printButton.addEventListener('click', () => {
                        window.print();
                    });
                }
                initializeNav();
            };

            analyzeButton.addEventListener('click', handleAnalysis);
            updateButtonState();
        });

        function initializeNav() {
            try {
                const navLinks = document.querySelectorAll('.nav-link');
                const sections = document.querySelectorAll('main section');
                if (navLinks.length > 0 && sections.length > 0) {
                    const observer = new IntersectionObserver((entries) => {
                        let visibleSectionId = null;
                        entries.forEach(entry => {
                            if (entry.isIntersecting) {
                                if (!visibleSectionId) {
                                    visibleSectionId = entry.target.id;
                                }
                            }
                        });
                        if (visibleSectionId) {
                            navLinks.forEach(link => {
                                const linkHref = link.getAttribute('href');
                                if (linkHref) {
                                   link.classList.toggle('active', linkHref.substring(1) === visibleSectionId);
                                }
                            });
                        }
                    }, { root: null, rootMargin: '0px 0px -50% 0px', threshold: 0.5 });
                    sections.forEach(section => observer.observe(section));
                }
            } catch (e) {
                console.error("Error al inicializar la navegación:", e);
            }
        }
    </script>
</body>
</html>
